<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>document</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="font-[Tahoma] bg-gray-200 text-center">

  <div id="gameBox" class="bg-white p-5 mt-12 mx-auto w-72 rounded-xl shadow">
    <h2 id="question" class="text-lg font-bold">برای شروع دکمه را بزنید</h2>
    <input id="answer" type="text" placeholder="جواب..."
           class="p-2 m-1 w-11/12 border rounded" />
    <button onclick="checkAnswer()"
            class="p-2 m-1 w-11/12 bg-blue-500 text-white rounded hover:bg-blue-600 transition">
      ارسال
    </button>
    <p id="score" class="font-bold mt-2">امتیاز: 0</p>
    <p id="feedback" class="text-red-600 font-bold mt-2"></p>
    <button onclick="startGame()"
            class="p-2 m-1 w-11/12 bg-green-500 text-white rounded hover:bg-green-600 transition">
      شروع بازی
    </button>
  </div>

  <script>
    var questionBank = [
      {q:"پایتخت ایران چیست؟", a:"تهران"},
      {q:"بزرگ ترین قاره جهان کدام است؟", a:"آسیا"},
      {q:"طولانی ترین رودخانه جهان چیست؟", a:"نیل"},
      {q:"پایتخت فرانسه چیست؟", a:"پاریس"},
      {q:"کوچک ترین کشور جهان چیست؟", a:"واتیکان"}
    ];

    var questions = [];
    var index = 0;
    var score = 0;
    var cheated = false;

    function startGame() {
      questions = questionBank.sort(() => Math.random() - 0.5).slice(0, 20);
      index = 0;
      score = 0;
      document.getElementById('score').innerHTML = "امتیاز: " + score;
      document.getElementById('feedback').innerHTML = "";
      nextQuestion();
    }

    function nextQuestion() {
      if(index < questions.length) {
        document.getElementById('question').innerHTML = questions[index].q;
        document.getElementById('answer').value = "";
      } else {
        document.getElementById('question').innerHTML = "پایان بازی! امتیاز شما: " + score;
        document.getElementById('feedback').innerHTML = "";
      }
    }

    function checkAnswer() {
      var userAnswer = document.getElementById('answer').value;
      if(userAnswer == questions[index].a) {
        score++;
        document.getElementById('feedback').innerHTML = "درست جواب دادی";
        index++;
        nextQuestion();
      } else {
        score--;
        document.getElementById('feedback').innerHTML = "جواب اشتباه بود! جواب درست: " + questions[index].a;
        index++;
        setTimeout(nextQuestion, 1500);
      }
      document.getElementById('score').innerHTML = "امتیاز: " + score;
    }

    document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible' && cheated) {
            showCheatMessage();
        } else if (document.visibilityState === 'hidden') {
            cheated = true;
        }
    });

    function showCheatMessage() {
      document.body.innerHTML = `
        <div class="cheat-screen flex flex-col justify-center items-center h-screen bg-red-600 text-white text-4xl font-bold text-center" id="cheatMessage">
        </div>`;
      typeWriter("شما تقلب کردید!", () => {
        setTimeout(() => {
          document.getElementById('cheatMessage').innerHTML = "";
          typeWriter("مجددا صفحه را رفرش کنید", null);
        }, 1000);
      });
    }

    function typeWriter(text, callback) {
      let i = 0;
      function typing() {
        if (i < text.length) {
          document.getElementById('cheatMessage').innerHTML += text.charAt(i);
          i++;
          setTimeout(typing, 150);
        } else if(callback) {
          setTimeout(callback, 500);
        }
      }
      typing();
    }
  </script>
</body>
</html>
